<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>System Wyników Sejmowych</title>
    <style>
        body { 
            background: white; 
            color: #000; 
            font-family: "Times New Roman", Times, serif; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .sejm-board {
            width: 80%;
            max-width: 900px;
            padding: 50px;
        }
        .header {
            font-size: 2.5rem;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 60px;
            letter-spacing: 2px;
        }
        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 35px 0;
            font-size: 3.5rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .total-row {
            margin-bottom: 80px;
            padding-bottom: 10px;
        }
        .label { flex: 1; }
        .val { width: 250px; text-align: right; }
        #waiting { font-size: 2rem; color: #777; text-align: center; font-style: italic; }
    </style>
</head>
<body>
    <div class="sejm-board">
        <div id="content" style="display:none;">
            <div class="header" id="title">GŁOSOWANIE</div>
            <div class="row total-row">
                <div class="label">GŁOSOWAŁO</div>
                <div class="val" id="total">0</div>
            </div>
            <div id="results"></div>
        </div>
        <div id="waiting">Oczekiwanie na zakończenie głosowania...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBo7bSndks_GClZBvnDMIsdVRWw5oCWiRM",
            authDomain: "votelive-f469d.firebaseapp.com",
            projectId: "votelive-f469d",
            storageBucket: "votelive-f469d.firebasestorage.app",
            messagingSenderId: "959356764271",
            appId: "1:959356764271:web:76f0284a0a1ce6e9874d9a" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        onSnapshot(doc(db, "ankiet", "vote"), (snap) => {
            const data = snap.data();
            if(!data) return;
            
            if(data.status === "zamkniete") {
                document.getElementById('waiting').style.display = "none";
                document.getElementById('content').style.display = "block";
                
                document.getElementById('title').innerText = data.tytul.toUpperCase();
                const resDiv = document.getElementById('results');
                resDiv.innerHTML = "";
                
                let total = Object.values(data.wyniki || {}).reduce((a, b) => a + b, 0);
                document.getElementById('total').innerText = total;

                const order = ["ZA", "PRZECIW", "WSTRZYM"];
                const entries = Object.entries(data.wyniki || {}).sort((a,b) => {
                    let iA = order.findIndex(l => a[0].toUpperCase().includes(l));
                    let iB = order.findIndex(l => b[0].toUpperCase().includes(l));
                    return (iA===-1?99:iA) - (iB===-1?99:iB);
                });

                entries.forEach(([key, val]) => {
                    resDiv.innerHTML += `<div class="row"><div class="label">${key.toUpperCase()}</div><div class="val">${val}</div></div>`;
                });
            } else {
                document.getElementById('waiting').style.display = "block";
                document.getElementById('content').style.display = "none";
            }
        });
    </script>
</body>
</html>
