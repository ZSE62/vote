<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Wyniki Głosowania</title>
    <style>
        body { background: white; color: #000; font-family: "Times New Roman", Times, serif; padding: 40px; }
        .board { max-width: 1000px; margin: auto; }
        .header {
            font-size: 2.8rem;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            padding-bottom: 20px;
            margin-bottom: 40px;
            border-bottom: 5px solid #000; /* Krecha pod tytułem */
        }
        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 25px 0;
            font-size: 2.5rem;
            font-weight: bold;
        }
        .label { flex: 1; text-transform: uppercase; }
        .bar-container { flex: 2; height: 35px; background: #eee; margin: 0 30px; border: 1px solid #000; position: relative; }
        .bar { height: 100%; transition: width 1s ease-out; }
        .val { width: 100px; text-align: right; }
        
        /* Kolory Sejmowe */
        .bg-za { background: #27ae60; }
        .bg-przeciw { background: #c0392b; }
        .bg-wstrzymuje { background: #f1c40f; }
        .bg-default { background: #34495e; }

        #total { font-size: 1.8rem; border-top: 2px solid #000; margin-top: 50px; padding-top: 20px; text-align: right; }
        #waiting { font-size: 2rem; text-align: center; margin-top: 100px; color: #777; font-style: italic; }
    </style>
</head>
<body>
    <div class="board">
        <div id="content" style="display:none;">
            <div class="header" id="title">GŁOSOWANIE</div>
            <div id="results"></div>
            <div id="total"></div>
        </div>
        <div id="waiting">Oczekiwanie na zakończenie głosowania...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBo7bSndks_GClZBvnDMIsdVRWw5oCWiRM",
            authDomain: "votelive-f469d.firebaseapp.com",
            projectId: "votelive-f469d",
            storageBucket: "votelive-f469d.firebasestorage.app",
            messagingSenderId: "959356764271",
            appId: "1:959356764271:web:76f0284a0a1ce6e9874d9a" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        onSnapshot(doc(db, "ankiet", "vote"), (snap) => {
            const data = snap.data();
            if(!data) return;

            if(data.status === "zamkniete") {
                document.getElementById('waiting').style.display = "none";
                document.getElementById('content').style.display = "block";
                document.getElementById('title').innerText = data.tytul.toUpperCase();

                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = "";
                
                const entries = Object.entries(data.wyniki || {});
                const total = entries.reduce((a, b) => a + b[1], 0);
                document.getElementById('total').innerText = "SUMA GŁOSÓW: " + total;

                entries.forEach(([key, val]) => {
                    const proc = total > 0 ? (val / total * 100) : 0;
                    let color = "bg-default";
                    const u = key.toUpperCase();
                    if(u.includes("ZA")) color = "bg-za";
                    else if(u.includes("PRZECIW")) color = "bg-przeciw";
                    else if(u.includes("WSTRZYM")) color = "bg-wstrzymuje";

                    resultsDiv.innerHTML += `
                        <div class="row">
                            <div class="label">${key}</div>
                            <div class="bar-container"><div class="bar ${color}" style="width: ${proc}%"></div></div>
                            <div class="val">${val}</div>
                        </div>
                    `;
                });
            } else {
                document.getElementById('content').style.display = "none";
                document.getElementById('waiting').style.display = "block";
            }
        });
    </script>
</body>
</html>
