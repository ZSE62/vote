<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>System @mperek</title>
<style>
body { font-family: "Times New Roman", Times, serif; background: white; color: black; padding:40px; display:flex; justify-content:center; }
.monitor { width:850px; }
.header { font-size:46px; text-align:center; text-transform:uppercase; font-weight:bold; margin-bottom:60px; }
.row { display:flex; justify-content:space-between; font-size:62px; font-weight:bold; margin-bottom:25px; text-transform:uppercase; }
.msg { font-size:58px; text-align:center; margin-top:100px; font-weight:bold; }
</style>
</head>
<body>
<div class="monitor" id="main-container"></div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = { apiKey:"API_KEY", authDomain:"votelive-f469d.firebaseapp.com", projectId:"votelive-f469d", appId:"APP_ID" };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const docRef = doc(db,"ankiet","vote");

onSnapshot(docRef,snap=>{
  const data=snap.data(); if(!data) return;
  const container=document.getElementById('main-container');

  if(data.status==="reset_wszystkich"){ container.innerHTML=`<div class="msg">SESJA ZAMKNIĘTA</div>`; return; }
  if(data.status==="otwarte"){ container.innerHTML=`<div class="header">${data.tytul.toUpperCase()}</div><div class="msg">GŁOSOWANIE W TOKU...</div>`; return; }

  let keys=Object.keys(data.wyniki||{});
  const order=["ZA","PRZECIW","WSTRZYMAŁO SIĘ"];
  keys.sort((a,b)=>{ let idxA=order.indexOf(a),idxB=order.indexOf(b); return (idxA===-1?99:idxA)-(idxB===-1?99:idxB); });

  let suma=0, rowsHTML="";
  keys.forEach(k=>{ suma+=data.wyniki[k]; rowsHTML+=`<div class="row"><span>${k}</span><span>${data.wyniki[k]}</span></div>`; });

  container.innerHTML=`
    <div class="header">${data.tytul.toUpperCase()}</div>
    <div class="row"><span>GŁOSOWAŁO</span><span>${suma}</span></div>
    <div style="height:50px"></div>
    ${rowsHTML}
  `;
});
</script>
</body>
</html>
